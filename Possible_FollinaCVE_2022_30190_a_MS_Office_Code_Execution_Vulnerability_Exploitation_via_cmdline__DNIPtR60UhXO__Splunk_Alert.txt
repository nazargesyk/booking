[Possible "Follina"/CVE-2022-30190 - a MS Office Code Execution Vulnerability Exploitation (via cmdline)]
alert.severity = 2
description = Possible abuse of ms-msdt MSProtocol URI scheme to load and execute malicious code. (Rule ID: 1046a900-654d-4010-a491-a7cd2231eac1)
cron_schedule = 0 * * * *
disabled = 1
is_scheduled = 1
is_visible = 1
dispatch.earliest_time = -60m@m
dispatch.latest_time = now
search = source="WinEventLog:*" AND ((((ParentImage="*WINWORD.EXE" OR ParentImage="*EXCEL.EXE" OR ParentImage="*POWERPNT.EXE" OR ParentImage="*MSPUB.EXE" OR ParentImage="*VISIO.EXE" OR ParentImage="*OUTLOOK.EXE" OR ParentImage="*MSACCESS.EXE" OR ParentImage="*MSPROJECT.EXE" OR ParentImage="*ONENOTE.EXE") AND ((CommandLine="*msdt.exe*" OR CommandLine="*../*" OR CommandLine="*..\\*") OR (Image="*msdt.exe"))) OR ((ParentImage="*sdiagnhost.exe") AND  NOT (((Image="*System32\\conhost.exe" OR Image="*System32\\netsh.exe" OR Image="*System32\\wpr.exe") OR (Image="*Framework64*" AND Image="*csc.exe*" AND Image="*Microsoft.NET*"))))) OR ((ParentImage="*powershell.exe" OR ParentImage="*cscript.exe" OR ParentImage="*DllHost.exe" OR ParentImage="*gpscript.exe" OR ParentImage="*eqnedt32.exe" OR ParentImage="*hh.exe" OR ParentImage="*cmd.exe" OR ParentImage="*MSBuild.exe" OR ParentImage="*msdt.exe" OR ParentImage="*wscript.exe" OR ParentImage="*fltldr.exe" OR ParentImage="*mshta.exe" OR ParentImage="*RegAsm.exe" OR ParentImage="*regsvcs.exe" OR ParentImage="*rundll32.exe" OR ParentImage="*regsvr32.exe") AND (Image="*msdt.exe") AND (CommandLine="*skip*" OR CommandLine="*IT_RebrowseForFile*" OR CommandLine="*IT_BrowseForFile*" OR CommandLine="*ms-msdt:*" OR CommandLine="*af*" OR CommandLine="*PCWDiagnostic*")))
alert.suppress = 0
alert.track = 1