{
    "displayName": "Possible \"Follina\"/CVE-2022-30190 - a MS Office Code Execution Vulnerability Exploitation (via cmdline) by SOC Prime Team",
    "description": "Possible abuse of ms-msdt MSProtocol URI scheme to load and execute malicious code. Author: SOC Prime Team. Rule ID: 1046a900-654d-4010-a491-a7cd2231eac1. License: https://github.com/Neo23x0/sigma/blob/master/LICENSE.Detection.Rules.md. Reference: https://tdm.socprime.com/tdm/info/DNIPtR60UhXO.",
    "severity": "medium",
    "enabled": true,
    "query": "SecurityEvent |  where EventID == 4688 | where ((((ParentProcessName endswith 'WINWORD.EXE' or ParentProcessName endswith 'EXCEL.EXE' or ParentProcessName endswith 'POWERPNT.EXE' or ParentProcessName endswith 'MSPUB.EXE' or ParentProcessName endswith 'VISIO.EXE' or ParentProcessName endswith 'OUTLOOK.EXE' or ParentProcessName endswith 'MSACCESS.EXE' or ParentProcessName endswith 'MSPROJECT.EXE' or ParentProcessName endswith 'ONENOTE.EXE') and ((CommandLine contains 'msdt.exe' or CommandLine contains '../' or CommandLine contains @'..\\') or (NewProcessName endswith 'msdt.exe'))) or ((ParentProcessName endswith 'sdiagnhost.exe') and (((NewProcessName !endswith @'System32\\conhost.exe' or NewProcessName !endswith @'System32\\netsh.exe' or NewProcessName !endswith @'System32\\wpr.exe') or (NewProcessName !contains 'Framework64' and NewProcessName !contains 'csc.exe' and NewProcessName !contains 'Microsoft.NET'))))) or ((ParentProcessName endswith 'powershell.exe' or ParentProcessName endswith 'cscript.exe' or ParentProcessName endswith 'DllHost.exe' or ParentProcessName endswith 'gpscript.exe' or ParentProcessName endswith 'eqnedt32.exe' or ParentProcessName endswith 'hh.exe' or ParentProcessName endswith 'cmd.exe' or ParentProcessName endswith 'MSBuild.exe' or ParentProcessName endswith 'msdt.exe' or ParentProcessName endswith 'wscript.exe' or ParentProcessName endswith 'fltldr.exe' or ParentProcessName endswith 'mshta.exe' or ParentProcessName endswith 'RegAsm.exe' or ParentProcessName endswith 'regsvcs.exe' or ParentProcessName endswith 'rundll32.exe' or ParentProcessName endswith 'regsvr32.exe') and (NewProcessName endswith 'msdt.exe') and (CommandLine contains 'skip' or CommandLine contains 'IT_RebrowseForFile' or CommandLine contains 'IT_BrowseForFile' or CommandLine contains 'ms-msdt:' or CommandLine contains 'af' or CommandLine contains 'PCWDiagnostic'))) | extend AccountCustomEntity = TargetUserName | extend HostCustomEntity = Computer | extend IPCustomEntity = IpAddress",
    "queryFrequency": "PT30M",
    "queryPeriod": "PT30M",
    "triggerOperator": "GreaterThan",
    "triggerThreshold": 0,
    "suppressionDuration": "PT2H30M",
    "suppressionEnabled": true,
    "tactics": [
        "DefenseEvasion"
    ],
    "techniques": [
        "T1218",
        "T1221"
    ]
}